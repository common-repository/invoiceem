/*! Plugin reporting JavaScript. * @since 1.0.0 * @package InvoiceEM */
var accounting=accounting||{},ajaxurl=ajaxurl||"",Chart=Chart||{},iem_reporting_options=iem_reporting_options||{};!function(c){"use strict";c(document).ready(function(){var t=c.invoiceem||{},a=t.data||{};c.extend(a,{invoices_chart:"iem-invoices-chart",payments_chart:"iem-payments-chart"});var i=t.functions||{},e=t.options||{};t.reporting=t.reporting||{};var n=t.reporting;c.extend(n,{options:iem_reporting_options||{},invoices_chart_object:null,payments_chart_object:null,doughnut_options:{aspectRatio:1,legend:{position:"bottom"},tooltips:{callbacks:{label:function(t,e){var a=e.datasets[t.datasetIndex].data[t.index];if(0!=t.datasetIndex)return i.format_currency(a);var n=accounting.settings.number;return n.precision=0,accounting.formatNumber(a,n)}}}}});var o=n.options||{};n.prepare=n.prepare||{};var r=n.prepare;c.extend(r,{chart_draw:function(){Chart.pluginService.register({afterDraw:function(t){if(0===t.data.datasets.length){t.clear();var e=t.chart.ctx;e.save(),e.font="inherit",e.textAlign="center",e.textBaseline="middle",e.fillText(o.no_data,t.chart.width/2,t.chart.height/2),e.restore()}}})},fields:function(){c("#invoiceem_meta_box_chart_options select").change(function(){var e=c(this).closest(".inside").find(".iem-field").addClass("iem-loading"),a=e.find('input[type="hidden"],select').prop("disabled",!0);c.post({url:ajaxurl,data:{action:"iem_reporting",currency_id:a.filter("#iem-currency_id").val(),time_period:a.filter("#iem-time_period").val()},error:function(){e.removeClass("iem-loading"),a.prop("disabled",!1)},success:function(t){o=t,r.load_accounting(),r.invoices_chart(),r.payments_chart(),e.removeClass("iem-loading"),a.prop("disabled",!1)}})})},load_accounting:function(){e.accounting=o.accounting,i.load_accounting()},invoices_chart:function(){if(null==n.invoices_chart_object){var t=c("#iem-invoices-chart"),e=new Chart(t.get(0).getContext("2d"),{data:o.invoices,options:n.doughnut_options,type:"doughnut"});t.data(a.invoices_chart,e),n.invoices_chart_object=e}else n.invoices_chart_object.data=o.invoices,n.invoices_chart_object.update()},payments_chart:function(){if(null==n.payments_chart_object){var t=c("#iem-payments-chart"),e=new Chart(t.get(0).getContext("2d"),{data:o.payments,options:n.doughnut_options,type:"doughnut"});t.data(a.payments_chart,e),n.payments_chart_object=e}else n.payments_chart_object.data=o.payments,n.payments_chart_object.update()}}),r.chart_draw(),r.fields(),r.load_accounting(),r.invoices_chart(),r.payments_chart()})}(jQuery);